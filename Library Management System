class Library:
    def __init__(self, library_name):
        self.name = library_name
        self.books = []  # Book Details 
        self.users = {}  # phone_number
        self.lend_data = {}  # book_name

    def is_valid_phone(self, phone):
        return phone.isdigit() and 10 <= len(phone) <= 13

    def is_valid_text(self, text):
        return text.replace(" ", "").isalpha() and text[0].isupper()

    def register_user(self):
        phone = input("ðŸ“ž Enter Phone Number: ").strip()
        if not self.is_valid_phone(phone):
            print("âŒ Invalid phone number. Use 10â€“13 digits only.")
            return

        if phone in self.users:
            print("âœ… User already registered.")
        else:
            name = input("ðŸ‘¤ Enter Name: ").strip()
            place = input("ðŸ“ Enter Place: ").strip()

            if not self.is_valid_text(name):
                print("âŒ Invalid name. Must start with a capital letter and contain only letters.")
                return
            if not self.is_valid_text(place):
                print("âŒ Invalid place. Must start with a capital letter and contain only letters.")
                return

            self.users[phone] = {'name': name, 'place': place}
            print(f"âœ… User '{name}' registered successfully.")

    def add_book(self):
        name = input("ðŸ“˜ Enter Book Name: ").strip()
        author = input("âœï¸ Enter Author Name: ").strip()
        publisher = input("ðŸ¢ Enter Publisher Name: ").strip()

        if not self.is_valid_text(name):
            print("âŒ Invalid book name. Must start with a capital letter and contain only letters.")
            return
        if not self.is_valid_text(author):
            print("âŒ Invalid author name. Must start with a capital letter and contain only letters.")
            return
        if not self.is_valid_text(publisher):
            print("âŒ Invalid publisher name. Must start with a capital letter and contain only letters.")
            return

        for book in self.books:
            if book['name'].lower() == name.lower():
                print("âš ï¸ Book already exists.")
                return

        self.books.append({'name': name, 'author': author, 'publisher': publisher})
        print(f"âœ… Book '{name}' added successfully.")

    def display_books(self):
        if not self.books:
            print("ðŸ“š No books in the library.")
            return
        print(f"\nðŸ“– Books in {self.name}:")
        for book in self.books:
            status = "Available" if book['name'] not in self.lend_data else f"Lent to {self.users[self.lend_data[book['name']]]['name']}"
            print(f" - {book['name']} | Author: {book['author']} | Publisher: {book['publisher']} | Status: {status}")

    def lend_book(self):
        phone = input("ðŸ“ž Enter Your Phone Number: ").strip()
        if phone not in self.users:
            print("âŒ User not found. Please register first.")
            return

        book_name = input("ðŸ“˜ Enter Book Name to Lend: ").strip()

        for book in self.books:
            if book['name'].lower() == book_name.lower():
                if book['name'] in self.lend_data:
                    current_user = self.users[self.lend_data[book['name']]]['name']
                    print(f"â— Book already lent to {current_user}.")
                    return
                self.lend_data[book['name']] = phone
                print(f"âœ… Book '{book['name']}' lent to {self.users[phone]['name']}.")
                return

        print("âŒ Book not found.")

    def return_book(self):
        book_name = input("ðŸ“˜ Enter Book Name to Return: ").strip()
        if book_name in self.lend_data:
            self.lend_data.pop(book_name)
            print(f"âœ… Book '{book_name}' returned.")
        else:
            print("âŒ This book was not lent out.")

    def display_users(self):
        if not self.users:
            print("âŒ No users registered.")
            return
        print("\nðŸ‘¥ Registered Users:")
        for phone, info in self.users.items():
            print(f" - {info['name']} | ðŸ“ž {phone} | ðŸ“ {info['place']}")

# ---------- Main Menu ----------
def main():
    lib = Library("City Library")

    while True:
        print("\nðŸ“Œ --- Library Menu ---")
        print("1. Register User")
        print("2. Add Book")
        print("3. Display Books")
        print("4. Lend Book")
        print("5. Return Book")
        print("6. Display Users")
        print("7. Exit")

        choice = input("Enter your choice (1â€“7): ")

        if choice == "1":
            lib.register_user()
        elif choice == "2":
            lib.add_book()
        elif choice == "3":
            lib.display_books()
        elif choice == "4":
            lib.lend_book()
        elif choice == "5":
            lib.return_book()
        elif choice == "6":
            lib.display_users()
        elif choice == "7":
            print("ðŸ‘‹ Exiting Library System. Goodbye!")
            break
        else:
            print("âŒ Invalid choice. Please enter a number from 1 to 7.")

if __name__ == "__main__":
    main()
